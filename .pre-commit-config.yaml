# Pre-commit hooks configuration for AI-Tutor project
# This configuration ensures code quality and consistency across the team
#
# Installation:
#   pip install pre-commit
#   pre-commit install
#
# Usage:
#   pre-commit run --all-files  # Run on all files
#   git commit  # Hooks run automatically on commit

repos:
  # ============================================
  # General file checks
  # ============================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
        exclude: ^(assets/roster/.*\.svg|.*\.min\.(js|css)|.*\.lock|.*\.log|.*\.pdf|.*\.zip|.*\.tar\.gz)

      - id: end-of-file-fixer
        exclude: ^(assets/roster/.*\.svg|.*\.min\.(js|css)|.*\.lock|.*\.log|.*\.pdf|.*\.zip|.*\.tar\.gz)

      - id: check-yaml
        args: [--unsafe]

      - id: check-json
        exclude: ^(.*\.lock|.*\.log)

      - id: check-added-large-files
        args: [--maxkb=6144]

      - id: check-merge-conflict
      - id: check-case-conflict
      - id: check-toml

  # ============================================
  # Python code formatting and linting
  # ============================================
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.7
    hooks:
      - id: ruff
        # Added --quiet to suppress logs; --exit-zero makes it a "soft fail" if desired
        args: [--fix, --quiet, --exit-zero]

      - id: ruff-format
        args: [--quiet]

  # ============================================
  # Frontend code formatting and linting
  # ============================================
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        args: [--log-level, warn]
        files: ^web/.*\.(css|scss|json|jsonc|yaml|yml|md|graphql|html|ts|tsx|js|jsx)$
        exclude: ^web/(node_modules|\.next|out|dist|build)/

  # ============================================
  # Security checks
  # ============================================
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        args: ['--baseline', '.secrets.baseline']
        exclude: package-lock.json
        pass_filenames: false

  # Replaced Safety with pip-audit due to version 3.x breakdown
  # NOTE: pip-audit disabled due to pip-api upstream bug with non-ASCII paths on Windows
  # (UnicodeDecodeError when username contains Chinese characters)
  # See: https://github.com/di/pip-api/issues/123
  # - repo: https://github.com/pypa/pip-audit
  #   rev: v2.7.3
  #   hooks:
  #     - id: pip-audit
  #       args: ["--desc", "on"]

  - repo: https://github.com/PyCQA/bandit
    rev: 1.8.0
    hooks:
      - id: bandit
        args: [-c, pyproject.toml, -q]
        exclude: ^tests/
        additional_dependencies: ["bandit[toml]"]

  # ============================================
  # Type checking
  # ============================================
  # Type checking - currently relaxed due to gradual type adoption
  # TODO: Gradually enable stricter checks as types are added
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.13.0
    hooks:
      - id: mypy
        args: [--ignore-missing-imports, --no-error-summary, --no-strict-optional]
        exclude: ^(tests/|scripts/|src/agents/|src/services/rag/|src/api/routers/)
        additional_dependencies:
          - types-PyYAML
          - types-requests
